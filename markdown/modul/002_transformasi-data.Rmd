---
title: "Modul 2: Transformasi Data"
author: "Big Data and Business Analytics Laboratory, SBM-ITB"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
# Set Knit
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 60), tidy = TRUE)
```

Data transformation atau transformasi data merupakan proses mengubah data dari satu format/struktur ke format/struktur lain. Proses transformasi data diperlukan pada kondisi dimana format/struktur data yang dimiliki, belum sesuai dengan format/struktur yang ditentukan pada proses analisis data. Proses transformasi data tidak memiliki standar atau prosedur yang tetap, semua dikembalikan pada kondisi data yang kita miliki dan format/struktur akhir yang diinginkan.  

Pada praktek kali ini kita akan belajar untuk melakukan transformasi data menggunakan library  ```dplyr```.  Library yang dikembangkan oleh Hadley Wickham dan Roman Francois ini memberikan banyak fungsi yang mudah digunakan untuk melakukan transformasi data. Karena tujuannya untuk melakukan transformasi data, library ```dplyr``` ini menjadi sangat berguna ketika digunakan untuk melakukan analisis dan eksplorasi data. 

Sebelum dapat digunakan, library ```dplyr``` ini perlu kita install dan load terlebih dulu.

```{r eval=FALSE, include=TRUE}
# Install library
install.packages("dplyr")
```

```{r message=FALSE, warning=FALSE}
# Load library
library("dplyr")
```

## Import Data

Untuk melakukan transformasi data kita harus memiliki data yang akan ditransformasi terlebih dahulu. Dataset yang akan kita gunakan di modul kali ini adalah dataset Bank Marketing yang didapatkan dari Kaggle. Dataset Bank Marketing berisikan informasi terkait Marketing Campaign sebuah Bank di Portugis. Marketing Campaign ini bertujuan untuk menawarakan deposito berjangka (Term Deposit) kepada para nasabah. Informasi lengkap mengenai dataset ini dapat dilihat di [Kaggle](https://www.kaggle.com/henriqueyamahata/bank-marketing). Datasetnya sendiri sudah didownload dan disimpan didalam directory ```data/raw```. 

Untuk memulai, mari kita import datanya terlebih dulu. Karena kita sudah menginstall ```readr``` di modul sebelumnya, kita tidak perlu menginstalnya lagi. Cukup meload atau memuat librarynya saja. 

```{r}
# Load library readr
library(readr)
```

```{r message=FALSE, warning=FALSE}
# Import data bank-marketing.csv from data/raw directory
df <- read_csv2("data/raw/bank-marketing.csv")
```

Sekarang datanya sudah terimport ke dalam environment R. Kita dapat 5 baris pertama data kita dengan menggunakan fungsi ```head()```.

```{r}
# Show the first 5 rows
head(df)
```

## Fungsi umum pada dplyr

Library ```dplyr``` menyediakan banyak sekali fungsi yang dapat digunakan untuk melakukan tranformasi data. Di modul ini kita akan belajar beberapa fungsi-fungsi umum dari library ```dplyr```

### Glimpse
Fungsi yang pertama akan kita pelajari adalah fungsi ```glimpse()```. Fungsi ```glimpse()``` berfungsi untuk menampilkan rangkuman informasi tentang keadaan data yang kita miliki, mirip seperti fungsi ```str()```. 

Informasi yang ditampilkan meliputi jumlah observasi (Jumlah baris dan jumlah variabel/kolom), tipe variabel, dan beberapa contoh data.

```{r}
# Glimpse
glimpse(df)
```

### Select
Fungsi selanjutnya adalah fungsi ```select```. Fungsi ```select``` digunakan untuk mengambil satu atau beberapa variabel tertentu dari sebuah dataframe. Contoh kita akan mengambil variable "age" dan "job", dan informasi apakah nasabah tersebut berlangganan deposito berjangka atau tidak

```{r}
# Select variable "age" and "job"
df_select <- select(df, c("age", "job", "y"))

# Show the first 5 rows
head(df_select)
```

Contoh lainnya kita juga dapat mengambil variable "age" dan "marital".

```{r}
# Select Variable "age" and "marital"
df_usia_nikah <- select(df, c("age", "marital"))

# Show the first 5 rows
head(df_usia_nikah)
```

### Filter
Fungsi ```filter()``` digunakan untuk menyeleksi dan menampilkan data sesuai dengan ketentuan yang diberikan. Contoh kita akan memfilter data nasabah yang memiliki pekerjaan sebagai admin, atau memfilter nasabah berlangganan deposito berjangka

```{r}
# Filter job = Admin
df_filter <- filter(df, job == "admin.")

# Show the first 5 rows
head(df_filter)
```

```{r}
# Filter y = yes
df_married <- filter(df, y == "yes")

# Show the first 5 rows
head(df_married)
```

### Mutate
Fungsi ```mutate()``` dapat digunakan untuk memodifikasi atau menambahkan variabel baru. Variabel baru tersebut dapat berupa variabel kategorik maupun numerik. Contoh kita akan membuat variable baru yang berisikan rasio ```usia/jumlah saldo tabungan``` masing-masing nasabah.

```{r}
# Create new variable using muatate()
df_mutate <- mutate(df, balance_ratio = balance / age)

# Show the first 5 rows
head(df_mutate)
```

### Sampling
Fungsi ini digunakan untuk mengambil sample secara acak pada data. Fungsi ```sample_n()``` berarti mengambil sampel berdasarkan nilai n yang ditentukan. Contoh kita akan mengambil sample sebanyak 100 dari data. 

```{r}
# Take 100 data samples
df_sample <- sample_n(df, 100)

# Show the first 5 rows
head(df_sample)

# Show data dimensions
dim(df_sample)
```

### Summarize
Fungsi ```summarise()``` digunakan untuk meringkas beberapa nilai data menjadi satu nilai. Fungsi ini akan menjadi sangat berguna apabila digabungkan fungsi lain dalam ```dplyr```. Fungsi di dalam summarise yang dapat digunakan seperti ```mean()```, ```median()```, ```sd()```,  ```min()```, ```max()```, ```quantile()```, ```first()```, ```last()```. Contoh kita akan menghitung rata-rata usia nasabah.

```{r}
# Calculate the mean of variable "age"
df_summarise <- summarise(df, mean(age))

# Show the first 5 rows
print(df_summarise)
```

### Arrange
Fungsi ```arrange()``` berguna untuk mengurutkan data berdasarkan nilai. Variabel yang menjadi acuan untuk diurutkan dapat lebih dari satu dan dapat ditentukan apakah dari besar ke kecil atau dari kecil ke besar. Contoh kita akan mengurutkan data kita berdasarkan usia. 

```{r}
# Sort data by "age"
df_arrange <- arrange(df, age)

# Show the first 5 rows
head(df_arrange)
```

### Pipe 
Fungsi ini menggunakan notasi ```%>%``` yang berguna untuk membuat fungsi berantai atau fungsi terus menerus. Fungsi pipe memungkinkan kita menuliskan lebih dari satu fungsi sekaligus tanpa harus menyimpannya terlebih dahulu. Contoh kita akan mencari nilai rata-rata saldo tabungan dari nasabah yang berlangganan deposito berjangka dan yang tidak

```{r}
# Create pipe to find the average balance of customers who subscribe to term deposits
df_pipe <- df %>%
  filter(y == "yes") %>%
  summarise(mean(balance))

print(df_pipe)
```
```{r}
# Create pipe to find the average balance of customers who not subscribe to term deposits
df_pipe <- df %>%
  filter(y == "no") %>%
  summarise(mean(balance))

print(df_pipe)
```

## Praktek
Sekarang teman-teman sudah paham teknik-teknik melakukan transformasi data menggunakan library ```dplyr```. Sekarang saatnya kita meangaplikasikan ke kasus baru. Kita akan menggunakan dataset telco customer churn dataset yang juga tersedia di Kaggle.

### Tentang Telco Customer Churn Datataset
Dataset Telco customer churn berisikan informasi __

```{r}
# Import Customer Churn Dataset
df_churn <- read_csv("data/raw/customer-churn.csv")
```


### Soal  
Di praktek ini teman-teman akan menjadi seorang data scientist di perusahaan telekomunikasi tersebut dan bertugas untuk menjawab pertanyaan-pertanyaan yang ajukan oleh manajemen berdasarkan data yang diberikan menggunakan library ```dplyr```.

#### Contoh Soal: Berapa banyak jumlah pelanggan yang churn? 
```{r}
# Answer
df_churn %>%
  filter(Churn == "Yes") %>%
  count()
```

#### Soal 1: Berapa banyak pelanggan yang tidak churn?
```{r}
# Answer to Question 1

```

#### Soal 2: Carilah 5 pelanggan yang memiliki jumlah tagihan tertinggi?
```{r}
# Answer to Question 2

```

#### Soal 3: Carilah daftar pelanggan yang churn dibawah 3 bulan berlangganan
```{r}
# Answer to Question 3

```

#### Soal 4: Carilah daftar pelanggan yang berlangganan layanan telepon
```{r}
# Answer to Question 4

```

#### Soal 5: Carilah rata-rata tagihan bulanan pelanggan yang churn dan tidak
```{r}
# Answer to Question 5

```

