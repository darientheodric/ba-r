---
title: "Modul 2: Transformasi Data"
author: "Big Data and Business Analytics Laboratory, SBM-ITB"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
# Set Knit
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 60), tidy = TRUE)
```

Data transformation merupakan proses mengubah data dari satu format atau struktur ke format atau struktur lain. Proses transformasi data tidak memiliki standar atau prosedur yang tetap, semua dikembalikan pada kondisi data yang kita miliki dan tujuan transformasi data.  

Pada praktek kali ini kita akan belajar untuk melakukan transformasi data menggunakan package  ```dplyr```.  Package ```dplyr``` ini dikembangkan oleh Hadley Wickham dan Roman Francois yang memberikan beberapa fungsi yang mudah digunakan. Package ini sangat berguna ketika digunakan untuk melakukan analisis dan eksplorasi data. Sebelum dapat digunakan, package dplyr ini perlu kita install dan load terlebih dulu.

```{r eval=FALSE, include=TRUE}
# Install package dplyr
install.packages("dplyr")
```

```{r message=FALSE, warning=FALSE}
# Load Package
library("dplyr")
```

## Import Data

Untuk melakukan transformasi data kita harus memiliki data yang akan ditransformasi terlebih dahulu. Dataset yang akan kita gunakan dalam modul kali ini adalah dataset Bank Marketing yang didapatkan dari Kaggle. Dataset Bank Marketing berisikan informasi terkait Marketing Campaign sebuah Bank di Portugis. Informasi lengkap mengenai dataset ini dapat dilihat di [Kaggle](https://www.kaggle.com/henriqueyamahata/bank-marketing).Datasetnya sendiri sudah didownload dan disimpan didalam directory data/raw. 

Untuk memulai, mari kita import datanya terlebih dulu. Karena kita sudah menginstall ```readr``` di modul sebelumnya, kita tidak perlu menginstalnya lagi. Cukup meload atau memuat packagenya saja. 

```{r}
# Load Package readr
library(readr)
```

```{r message=FALSE, warning=FALSE}
# Import data bank-marketing.csv from data/raw directory
df <- read_csv2("data/raw/bank-marketing.csv")
```

Sekarang datanya terimport ke dalam environment R. Kita dapat 5 baris pertama data kita dengan menggunakan fungsi ````head()```.

```{r}
# Show the first 5 rows
head(df)
```


Selain melihat 5 baris data kita, kita juga dapat melihat rangkuman data kita menggunakan fungsi ```glimpse()``` dari package ```dplyr```.

```{r}
# Show data summary using the glimpse() function
glimpse(df)
```

## Fungsi umum pada dplyr

Package dplyr menyediakan banyak sekali fungsi yang dapat digunakan untuk melakukan tranformasi data. Di modul ini kita akan belajar fungsi-fungsi umumnya saja.

### Glimpse

Fungsi yang pertama akan kita pelajari adalah fungsi ```glimpse()```, fungsi ini telah kita gunakan pada saat emilihat informasi data diatas. Fungsi ```glimpse()``` memiliki fungsi yang sama seperti ```str()``` yaitu memberikan rangkuman tentang keadaan data. Meliputi jumlah observasi atau baris dan jumlah variabel atau kolom. Kemudian memberikan informasi mengenai tipe dari variabel serta menampilkan sedikit informasi mengenai data kita.

```{r}
# Glimpse
glimpse(df)
```

### Select
fungsi selanjutnya adalah fungsi select. Fungsi select digunakan untuk mengambil satu atau beberapa variabel tertentu dari sebuah dataframe. Contoh kita akan mengambil variable "age dan "job" atau "age" dan "marital"nya saja. 

```{r}
# Select variable "age" and "job"
df_select <- select(df, c("age", "job"))

# Show the first 5 rows
head(df_select)
```

```{r}
# Select Variable "age" and "maritial"
df_usia_nikah <- select(df, c("age", "marital"))

# Show the first 5 rows
head(df_usia_nikah)
```

### Filter
Fungsi filter digunakan untuk menyeleksi dan menampilkan data sesuai dengan ketentuan. Contoh kita akan memfilter data pelanggan yang memiliki pekerjaan sebagai admin, atau memfilter pelanggan yang sudah menikah

```{r}
# Filter job = Admin
df_filter <- filter(df, job == "admin.")

# Show the first 5 rows
head(df_filter)
```

```{r}
# Filter marital = married
df_married <- filter(df, marital == "married")

# Show the first 5 rows
head(df_married)
```

### Mutate
Fungsi mutate dapat digunakan untuk menambahkan variabel baru. Variabel baru tersebut dapat berupa variabel kategorik maupun numerik. Contoh kita akan membuat variable baru dengan yang merupakan rasio usia/jumlah tabungan.

```{r}
# Create new variable
df_mutate <- mutate(df, balance_ratio = balance / age)

# Show the first 5 rows
head(df_mutate)
```

### Sampling
Fungsi ini digunakan untuk mengambil secara acak pada data. Fungsi sample_n berarti mengambil sampel berdasarkan nilai n yang ditentukan. Contoh kita akan mengambil sample sebanyak 100 dari data. 

```{r}
# Take 100 data samples
df_sample <- sample_n(df, 100)

# Show the first 5 rows
head(df_sample)

# Show data dimensions
dim(df_sample)
```

```{r}
# Take 200 data samples
df_200 <- sample_n(df, 200)

# Show the first 5 rows
dim(df_200)
```

### Summarize
Fungsi summarise digunakan untuk meringkas beberapa nilai data menjadi satu nilai. Fungsi ini akan menjadi sangat berguna apabila digabungkan fungsi lain dalam dplyr. na.rm = TRUE memberikan hasil fungsi dengan meniadakan nilai missing. Fungsi di dalam summarise yang dapat digunakan seperti mean(), median(), sd(), IQR(), mad(), min(), max(), quantile(), first(), last(), nth(), n(), n_distinct(), any(), dan all(). Contoh kita akan menghitung rata-rata usia pelanggan

```{r}
# Calcuate the mean of variable "age"
df_summarise <- summarise(df, mean(age))

# Show the first 5 rows
print(df_summarise)
```

### Arrange
Fungsi arrange berguna untuk mengurutkan data berdasarkan variabel. Variabel yang menjadi acuan untuk diurutkan dapat lebih dari satu dan dapat ditentukan apakah dari besar ke kecil atau dari kecil ke besar. Contoh kita akan mengurutkan data kita berdasarkan usia. 

```{r}
# Sort data by "age"
df_arrange <- arrange(df, age)

# Show the first 5 rows
head(df_arrange)
```

```{r}
# Sort data by "balance"
df_balance <- arrange(df, balance)

# Show the first 5 rows
head(df_balance)
```

### Pipe 
Fungsi ini menggunakan %>% yang berguna untuk fungsi berantai atau terus menerus. Sehingga dapat menuliskan lebih dari satu fungsi sekaligus tanpa harus menyimpannya terlebih dahulu. Contoh kita akan mengambil sample sebanyak 100, lalu di filter yang usianya dibawah 30, dan diurutkan berdasarkan jumlah saldo tabungan yang paling besar. 

```{r}
# Create pipe to to find customers under the age of 30 with the largest balance
df_pipe <- df %>%
  sample_n(100) %>%
  filter(age < 30) %>%
  arrange(desc(balance))

# Show the first 5 rows
head(df_pipe)
```

```{r}
# Create pipe to find the highest balance of unmarried / single customers 
df_balance_single <- df %>%
  filter(marital == "single") %>%
  arrange(desc(balance))

# Show the first 5 rows
head(df_balance_single)
```
