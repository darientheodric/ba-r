---
title: 'Praktek Modul 4: Machine Learning'
author: "Big Data and Business Analytics Laboratory, SBM-ITB"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Sekarang kamu sudah paham teknik-teknik untuk membuat model klasifikasi menggunakan prinsip machine learning Sekarang saatnya kita meangaplikasikan ke kasus baru.  Sama seperti modul-modul sebelumnya. Kita akan menggunakan telco customer churn dataset yang tersedia di Kaggle.

## Tentang Dataset
Telco Customer Churn merupakan __

## Soal: Buatlah model klasifikasi untuk memprediksi apakah suatu pelanggan akan churn atau tidak

```{r}
# Load Library
library(tidyverse)
library(tidymodels)
library(discrim)
```

### Import data
```{r}
# Import Data
df_churn <- read_csv("data/raw/customer-churn.csv")
```

```{r}
# Melihat rangkuman informasi data menggunakan fungsi glimpse()
glimpse(df_churn)
```

### Split data
```{r}
# Split Data with 70:30 Proportion
df_churn_split <- initial_split(df_churn, prop = 0.7)
df_churn_split
```

### Membuat alur Pemrosesan data
```{r}
# Create Recipe
df_churn_recipe <- training(df_churn_split) %>%
  recipe(Churn ~.) %>%
  update_role(customerID, new_role = "id variable") %>%
  step_medianimpute(all_numeric()) %>%
  prep()

df_churn_recipe
```

```{r}
# See training data using juice
df_churn_training <- juice(df_churn_recipe)
glimpse(df_churn_training)
```

```{r}
# See the testing data using bake
df_churn_testing <- df_churn_recipe %>%
  bake(testing(df_churn_split)) 

glimpse(df_churn_testing)
```

### Menetapkan Algoritma

```{r}
# Set the model
nb_mod <-  naive_Bayes(mode = "classification") %>%
  set_engine('naivebayes') 
```

### Membuat Workflow

```{r}
# Create Workflow
workflow_churn <- workflow() %>%
  add_model(nb_mod) %>%
  add_recipe(df_churn_recipe)
```

### Traning dan Prediksi ke Data Test

```{r}
# Train The model
churn_nb <- fit(workflow_churn, training(df_churn_split))

# Predict
head(predict(churn_nb, testing(df_churn_split)))
```

### Evaluasi Model

```{r}
# Define metric for evaluation
multi_metrics <- metric_set(accuracy, sensitivity, recall, f_meas)

# See Performance Evaluation
churn_nb %>%
  predict(df_churn_testing) %>%
  bind_cols(df_churn_testing) %>%
  multi_metrics(truth = Churn, estimate = .pred_class)
```
